@page "/AdminPanel.html"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@{
 ViewData["Title"] = "Panel administratora";
}

<style>
 .admin-grid {
 display: grid;
 gap:1rem;
 }

 .two-col {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
 gap: .75rem;
 }

 .msg { margin-top: .5rem; font-size: .95rem; }
 .msg.error { color: #ff6b6b; }
 .msg.success { color: #2ecc71; }

 .logs-box { margin-top:1rem; }
 .logs-item { padding: .45rem .6rem; border-bottom:1px solid rgba(255,255,255,.15); }
 .logs-item .lvl { font-weight:700; margin-right: .4rem; }

 .delete-box { margin-top:1.2rem; }

 /* Price manager removed (managed elsewhere) */
 .prices-box { margin-top: .8rem; }
 .price-actions { display:flex; gap:8px; align-items:center; }
</style>

<div class="content-section">
 <div class="frost-effect admin-grid">
 <h1 class="winter-title">🛠️ Panel administratora</h1>

 <!-- Dodawanie pracownika -->
 <div class="form-box">
 <h2 class="section-title" style="text-align:center;">👷 Dodaj pracownika</h2>
 <form id="workerForm" novalidate>
 <div class="two-col">
 <label>Imię<input type="text" name="FirstName" required class="form-control" /></label>
 <label>Nazwisko<input type="text" name="LastName" required class="form-control" /></label>
 <label>Email<input type="email" name="Email" required class="form-control" /></label>
 <label>Telefon (9 cyfr)<input type="text" name="PhoneNumber" maxlength="9" pattern="\d{9}" required class="form-control" /></label>
 <label>Stanowisko (Job_Title)<input type="text" name="Job_Title" required class="form-control" /></label>
 <label>Hasło (min.6)<input type="password" name="Password" minlength="6" required class="form-control" /></label>
 <label>Adres (opcjonalnie)<input type="text" name="Address" class="form-control" /></label>
 <label>Dni pracy<input type="text" name="Working_Days" class="form-control" /></label>
 <label>Start pracy<input type="time" name="WorkStart" value="08:00" required class="form-control" /></label>
 <label>Koniec pracy<input type="time" name="WorkEnd" value="16:00" required class="form-control" /></label>
 </div>
 <div class="block-actions" style="margin-top:.5rem;">
 <button class="winter-button" type="submit">➕ Utwórz pracownika</button>
 </div>
 <div id="workerMsg" class="msg"></div>
 </form>
 </div>

 <!-- Usuwanie użytkownika -->
 <div class="form-box delete-box">
 <h2 class="section-title" style="text-align:center;">🗑️ Usuń użytkownika / pracownika</h2>
 <form id="deleteForm" novalidate>
 <label>Email do usunięcia<input type="email" name="DelEmail" id="delEmail" required placeholder="np. jan@firma.com" class="form-control" /></label>
 <div class="block-actions" style="margin-top:.6rem;">
 <button class="winter-button danger" type="submit">🗑️ Usuń</button>
 </div>
 <div id="deleteMsg" class="msg"></div>
 </form>
 </div>

 <!-- Price management removed from this panel (managed elsewhere) -->

 </div>
</div>

@section Scripts {
<script>
(async function () {
 // worker form submission: show success/error in #workerMsg
 const workerForm = document.getElementById('workerForm');
 const workerMsg = document.getElementById('workerMsg');
 if (workerForm) {
 workerForm.addEventListener('submit', async (ev) => {
 ev.preventDefault();
 try {
 workerMsg.className = 'msg';
 workerMsg.textContent = 'Tworzenie pracownika...';
 const fd = new FormData(workerForm);
 const payload = {
 FirstName: (fd.get('FirstName') || '').toString().trim(),
 LastName: (fd.get('LastName') || '').toString().trim(),
 Email: (fd.get('Email') || '').toString().trim(),
 PhoneNumber: (fd.get('PhoneNumber') || '').toString().trim(),
 Address: (fd.get('Address') || '').toString().trim() || null,
 WorkStart: (fd.get('WorkStart') || '').toString(),
 WorkEnd: (fd.get('WorkEnd') || '').toString(),
 Working_Days: (fd.get('Working_Days') || '').toString().trim() || null,
 Job_Title: (fd.get('Job_Title') || '').toString().trim(),
 Password: (fd.get('Password') || '').toString()
 };
 const res = await fetch('/api/Workers', {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 credentials: 'include',
 body: JSON.stringify(payload)
 });
 if (!res.ok) {
 const txt = await res.text();
 workerMsg.className = 'msg error';
 workerMsg.textContent = '❌ Błąd: ' + (txt || res.statusText || 'Nieznany błąd');
 return;
 }
 // success
 workerMsg.className = 'msg success';
 workerMsg.textContent = '✅ Utworzono pracownika: ' + payload.Email;
 workerForm.reset();
 } catch (err) {
 workerMsg.className = 'msg error';
 workerMsg.textContent = '❌ Błąd: ' + (err.message || err);
 }
 });
 }

 // delete user form
 const deleteForm = document.getElementById('deleteForm');
 const deleteMsg = document.getElementById('deleteMsg');
 if (deleteForm) {
 deleteForm.addEventListener('submit', async (ev) => {
 ev.preventDefault();
 try {
 deleteMsg.className = 'msg';
 deleteMsg.textContent = 'Usuwanie...';
 const fd = new FormData(deleteForm);
 const email = (fd.get('DelEmail') || '').toString().trim();
 if (!email) { deleteMsg.className = 'msg error'; deleteMsg.textContent = 'Podaj email.'; return; }
 const res = await fetch('/api/Users?email=' + encodeURIComponent(email), { method: 'DELETE', credentials: 'include' });
 if (!res.ok) {
 const txt = await res.text();
 deleteMsg.className = 'msg error'; deleteMsg.textContent = 'Błąd: ' + (txt || res.statusText || 'Nieznany błąd');
 return;
 }
 deleteMsg.className = 'msg success'; deleteMsg.textContent = 'Użytkownik usunięty.';
 deleteForm.reset();
 } catch (err) {
 deleteMsg.className = 'msg error'; deleteMsg.textContent = 'Błąd: ' + (err.message || err);
 }
 });
 }

})();
</script>
}