@{
    Layout = null;
}
@* main layout *@
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Rent</title>
    <link rel="stylesheet" href="/css/site.css" />
    <link rel="stylesheet" href="/css/equipment.css" />
    <link rel="stylesheet" href="/css/add-item.css" />
    @RenderSection("Styles", required: false)
</head>
<body>
    <header>
 <div class="buttons-top-right">
 <div class="buttons-inner">
 <a class="winter-button" href="/">Menu</a>
 <a class="winter-button" href="/Equipment.html" data-nav="/Equipment.html">Sprzęt</a>
 <details class="user-panel disabled">
 <summary class="winter-button">Panel użytkownika</summary>
 <div class="user-panel-menu">
 <a class="winter-button" href="/OrderHistory.html">Historia zamówień</a>
 <a class="winter-button" href="/UserData.html">Dane użytkownika</a>
 <a class="winter-button" href="/WorkerPanel.html" data-show-for-roles="Worker,Admin">Panel pracownika</a>
 <a class="winter-button" href="/AdminPanel.html" data-show-for-roles="Admin">Panel administratora</a>
 <a class="winter-button" href="/AddOrDeleteItem.html" data-show-for-roles="Admin">Dodaj / Usuń sprzęt</a>
 <a class="winter-button" href="/AppLogs.html" data-show-for-roles="Admin">Logi zamówień</a>
 <!-- worker info placeholder (hidden unless user is only Worker) -->
 <div id="workerInfo" style="display:none; margin-top: .5rem; padding:.6rem; border-radius:8px; background: rgba(255,255,255,0.03);">
 <!-- Filled by JS -->
 </div>
 </div>
 </details>
 <a class="winter-button" href="/Kontakt.html" data-nav="/Kontakt.html">Kontakt</a>
 <a class="winter-button" href="/Basket.html" data-nav="/Basket.html">Koszyk</a>
 <a id="loginBtn" class="winter-button" href="/Login.html">Logowanie</a>
 </div>
 </div>
 </header>

 <main>
 <div class="content-section">
 <div class="frost-effect">
 @RenderBody()
 </div>
 </div>
 </main>

 <footer></footer>

 <script src="/js/common.js"></script>
 <script>
 // navigation helpers reused across pages
 function setupNavAndAuthHandlers(){
 document.querySelectorAll('.clickable-block, [data-nav]').forEach(el => {
 el.style.cursor = el.style.cursor || 'pointer';
 el.addEventListener('click', (e) => {
 if (el.tagName.toLowerCase() === 'a' && el.getAttribute('href')) return;
 if (el.closest && el.closest('details') && el.tagName.toLowerCase() === 'summary') return;
 const nav = el.dataset.nav || el.getAttribute('data-nav'); if (!nav) return;
 const target = nav.startsWith('/') ? nav : ('/' + nav.replace(/^\/+/,''));
 window.location.href = target;
 });
 });

 // ensure login/logout works even if initAuth timing differs
 const loginBtn = document.getElementById('loginBtn');
 if (loginBtn) {
 loginBtn.addEventListener('click', async function(e){
 // if text is 'Wyloguj' (user logged in) then call logout endpoint
 try{
 const txt = (this.textContent || this.innerText || '').trim().toLowerCase();
 if (txt === 'wyloguj' || txt === 'wyloguj '){
 e.preventDefault();
 await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
 // reinitialize auth and refresh UI
 if (window.__rent && typeof window.__rent.initAuth === 'function') await window.__rent.initAuth();
 if (window.__rent && typeof window.__rent.applyRoleVisibility === 'function') window.__rent.applyRoleVisibility();
 // reload to ensure server state and cookies cleared
 window.location.reload();
 }
 }catch(err){ console.error('Logout failed', err); }
 });
 }

 // react to auth changes dispatched by common.js
 document.addEventListener('auth-changed', function(){ try{ if (window.__rent && typeof window.__rent.applyRoleVisibility === 'function') window.__rent.applyRoleVisibility(); }catch(e){} });
 }

 document.addEventListener('DOMContentLoaded', () => {
 setupNavAndAuthHandlers();
 // after common init, ensure auth is initialized
 if (window.__rent && typeof window.__rent.initAuth === 'function') window.__rent.initAuth();
 });
 </script>

 @RenderSection("Scripts", required: false)
</body>
</html>