@page "/UserData.html"
@{
 ViewData["Title"] = "Dane u¿ytkownika";
}

<h1 class="winter-title">Dane u¿ytkownika</h1>
<div class="content-section">
    <div class="frost-effect">
        <div id="userData" class="contact-info" data-show-when-auth="true">
            <p>£adowanie danych...</p>
        </div>

        <div class="alt-link" data-hide-when-auth="true">
            Aby zobaczyæ dane, zaloguj siê: <a href="/Login.html">Logowanie</a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            async function loadUser() {
                try {
                    const u = await (window.__rent && window.__rent.getMe ? window.__rent.getMe() : (async () => { const res = await fetch('/api/auth/me', { credentials: 'include' }); if (!res.ok) return null; return res.json(); })());
                    if (!u) return;
                    const el = document.getElementById('userData');
                    const userName = u.userName ?? u.UserName ?? u.username ?? '–';
                    const email = u.email ?? u.Email ?? u.EmailAddress ?? '–';
                    const phone = u.phoneNumber ?? u.PhoneNumber ?? u.ContactNumber ?? u.Contact_Number ?? u.Phone_number ?? u.phone ?? u.Phone ?? '–';
                    const firstName = u.first_name ?? u.First_name ?? u.FirstName ?? '–';
                    // handle possible JSON name variants for Last name coming from server
                    const lastName = u.last_name ?? u.Last_name ?? u.Last_Name ?? u.LastName ?? '–';
                    try { document.querySelectorAll('[data-edit-username], .edit-username').forEach(n => n.remove()); document.querySelectorAll('input[name="UserName"], input[name="userName"], input[name="username"]').forEach(i => { i.disabled = true; i.style.display = 'none'; }); } catch (e) { }
                    el.innerHTML = `\n <div class="contact-item"><strong>Nazwa u¿ytkownika</strong><div class="contact-value">${userName}</div></div>\n <div class="contact-item"><strong>Email</strong><div class="contact-value">${email}</div></div>\n <div class="contact-item"><strong>Telefon</strong><div class="contact-value">${phone}</div></div>\n <div class="contact-item"><strong>Imiê</strong><div class="contact-value">${firstName}</div></div>\n <div class="contact-item"><strong>Nazwisko</strong><div class="contact-value">${lastName}</div></div>`;
                } catch (e) { }
            }
            document.addEventListener('DOMContentLoaded', () => { loadUser(); if (window.__rent && typeof window.__rent.initAuth === 'function') window.__rent.initAuth(); if (window.__rent && typeof window.__rent.applyRoleVisibility === 'function') window.__rent.applyRoleVisibility(); });
        })();
    </script>
}